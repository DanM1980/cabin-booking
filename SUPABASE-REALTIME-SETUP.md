# הפעלת Supabase Realtime

## 📋 מה זה Realtime?

Supabase Realtime מאפשר לך לקבל עדכונים **בזמן אמת** כשמישהו משנה נתונים בדאטאבייס.
במערכת שלנו, כשמישהו מזמין יום או כותב בספר האורחים - כל המשתמשים הפתוחים יראו את העדכון **מיד** בלי לרענן!

---

## 🔧 הפעלת Realtime בSupabase

### שלב 1: כניסה ל-Supabase Dashboard

1. היכנס ל-[Supabase Dashboard](https://app.supabase.com)
2. בחר את הפרויקט שלך (`cabin-booking`)

### שלב 2: הפעלת Realtime לטבלאות

1. בתפריט הצד, לחץ על **Database** → **Replication**
2. תראה רשימת טבלאות. **הפעל** (toggle ON) את Realtime עבור הטבלאות הבאות:

   ✅ **calendar** - לוח השנה (זמינות ימים)
   ✅ **bookings** - הזמנות
   ✅ **guestbook** - ספר אורחים

### שלב 3: אישור שינויים

1. לאחר הפעלת כל טבלה, ייתכן שתצטרך לאשר את השינויים
2. אם מופיע כפתור **"Save"** או **"Apply"** - לחץ עליו

---

## 🧪 בדיקה שהכל עובד

### בדיקה 1: שני דפדפנים

1. פתח את **הדף הראשי** בשני דפדפנים שונים
2. באחד - הזמן יום
3. **בדפדפן השני** - תראה את העדכון **תוך שנייה** בלי לרענן!

### בדיקה 2: ספר אורחים

1. פתח את **הדף הראשי** בשני דפדפנים
2. באחד - כתוב הודעה בספר האורחים
3. **בדפדפן השני** - ההודעה תופיע **מיד**!

### בדיקה 3: ממשק ניהול

1. פתח את **ממשק הניהול** בדפדפן אחד
2. פתח את **הדף הראשי** בדפדפן אחר
3. במשתמש רגיל - הזמן יום
4. **בממשק הניהול** - תראה את העדכון **מיד**!

---

## 🐛 פתרון בעיות

### בעיה: העדכונים לא מגיעים

**פתרון 1: בדוק שהפעלת Realtime**
- עבור ל-**Database → Replication**
- וודא ש-toggle ירוק עבור `calendar`, `bookings`, `guestbook`

**פתרון 2: בדוק את הקונסול**
- פתח **Developer Tools** (F12)
- בלשונית **Console** - אם יש שגיאות אדומות, העתק אותן ושלח לתמיכה

**פתרון 3: רענן את הדף**
- לפעמים צריך לרענן פעם אחת אחרי הפעלת Realtime

---

## 📊 איך זה עובד בקוד?

### דף ראשי (`src/app/page.tsx`)

```typescript
// מנוי לשינויים בלוח השנה
const calendarSubscription = supabase
  .channel('calendar-changes')
  .on('postgres_changes', {
    event: '*', // כל שינוי: INSERT, UPDATE, DELETE
    schema: 'public',
    table: 'calendar',
  }, () => {
    loadMonthData(currentMonth); // טוען מחדש את הנתונים
  })
  .subscribe();
```

### ממשק ניהול (`src/app/admin/page.tsx`)

```typescript
// מנוי לשינויים בהזמנות
const bookingsSubscription = supabase
  .channel('admin-bookings-changes')
  .on('postgres_changes', {
    event: '*',
    schema: 'public',
    table: 'bookings',
  }, () => {
    loadMonthData(currentMonth);
    loadStats(); // מעדכן גם סטטיסטיקות
  })
  .subscribe();
```

---

## 💡 טיפים

1. **ביצועים**: המערכת מאזינה רק לטבלאות שצריך, לא לכל הDB
2. **ניקוי**: כשסוגרים את הדף, ה-subscriptions מתנתקים אוטומטית
3. **חסכון**: Supabase Realtime בחינם עד 200MB/חודש (יותר מספיק!)

---

## ✅ סיכום

אחרי שתפעיל את Realtime ב-Supabase Dashboard:

- ✅ משתמשים יראו הזמנות חדשות **בזמן אמת**
- ✅ הודעות בספר אורחים יופיעו **מיד**
- ✅ המנהל יראה שינויים **בלייב**
- ✅ אין צורך לרענן את הדף!

🎉 **המערכת כעת עובדת עם עדכונים בזמן אמת!**

